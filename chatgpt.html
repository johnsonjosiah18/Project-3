<!DOCTYPE html>
<html>
<head>
    <title>US Housing Market Map</title>
    <script src="https://d3js.org/d3.v5.js"></script>
    <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"/>
    <style>
        #mapid { height: 600px; width: 960px; }

        .info.legend {
            background: white;
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .info.legend i {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            float: left;
        }
    </style>
</head>
<body>
    <div id="mapid"></div>
    <!-- Add a dropdown for crime type filter -->
    <div>
        <label for="crimeTypeDropdown">Crime Type:</label>
        <select id="crimeTypeDropdown"></select>
    </div>

    <script>
        var map = L.map('mapid').setView([37.8, -96], 4); // Centered around the US
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Map data Â© <a href="https://www.openstreetmap.org/">OpenStreetMap</a>',
            maxZoom: 6,
        }).addTo(map);
        L.svg().addTo(map);

        d3.json('csvjson.json').then(function(data) {
            // Create a dictionary that maps abbreviated state names to full state names
            var stateAbbreviations = {
                'AL': 'Alabama',
                'AK': 'Alaska',
                'AZ': 'Arizona',
                'AR': 'Arkansas',
                'CA': 'California',
                'CO': 'Colorado',
                'CT': 'Connecticut',
                'DE': 'Delaware',
                'FL': 'Florida',
                'GA': 'Georgia',
                'HI': 'Hawaii',
                'ID': 'Idaho',
                'IL': 'Illinois',
                'IN': 'Indiana',
                'IA': 'Iowa',
                'KS': 'Kansas',
                'KY': 'Kentucky',
                'LA': 'Louisiana',
                'ME': 'Maine',
                'MD': 'Maryland',
                'MA': 'Massachusetts',
                'MI': 'Michigan',
                'MN': 'Minnesota',
                'MS': 'Mississippi',
                'MO': 'Missouri',
                'MT': 'Montana',
                'NE': 'Nebraska',
                'NV': 'Nevada',
                'NH': 'New Hampshire',
                'NJ': 'New Jersey',
                'NM': 'New Mexico',
                'NY': 'New York',
                'NC': 'North Carolina',
                'ND': 'North Dakota',
                'OH': 'Ohio',
                'OK': 'Oklahoma',
                'OR': 'Oregon',
                'PA': 'Pennsylvania',
                'RI': 'Rhode Island',
                'SC': 'South Carolina',
                'SD': 'South Dakota',
                'TN': 'Tennessee',
                'TX': 'Texas',
                'UT': 'Utah',
                'VT': 'Vermont',
                'VA': 'Virginia',
                'WA': 'Washington',
                'WV': 'West Virginia',
                'WI': 'Wisconsin',
                'WY': 'Wyoming'
            };

            // Create a dictionary that maps state names to median list prices
            var statePrices = {};
            data.forEach(function(d) {
                var stateName = stateAbbreviations[d.NAME.toUpperCase()] || d.NAME; // Use the original name if abbreviation not found

                statePrices[stateName] = +d.median_active_list_price;
            });

            // Load crime data
            d3.json('crimedatajson.json').then(function(crimeData) {
                // Create a dictionary to store crime data for each state
                var stateCrimeData = {};
                crimeData.forEach(function(d) {
                    var stateName = d.state_name;

                    stateCrimeData[stateName] = {
                        population: +d.population,
                        totalCrime: +d.total_crime,
                        violentCrime: +d.violent_crime,
                        homicide: +d.homicide,
                        robbery: +d.robbery,
                        aggravatedAssault: +d.aggravated_assault,
                        propertyCrime: +d.property_crime,
                        burglary: +d.burglary,
                        larceny: +d.larceny,
                        motorVehicleTheft: +d.motor_vehicle_theft
                        // Add other crime-related properties as needed
                    };
                });

                // Create a color scale
                var color = d3.scaleQuantize()
                    .range(['rgb(237,248,233)','rgb(186,228,179)','rgb(116,196,118)','rgb(49,163,84)','rgb(0,109,44)'])
                    .domain([166985, 981994]);  // Adjusted domain to match your data

                // Create a dropdown for selecting the crime type
                var crimeTypeDropdown = d3.select('#crimeTypeDropdown');

                // Populate the dropdown with unique crime types from your crime data
                var uniqueCrimeTypes = ['violentCrime', 'homicide', 'robbery', 'aggravatedAssault', 'propertyCrime', 'burglary', 'larceny', 'motorVehicleTheft'];
                crimeTypeDropdown.selectAll('option')
                    .data(uniqueCrimeTypes)
                    .enter().append('option')
                    .text(d => d)
                    .attr('value', d => d);

                // Add an event listener to handle changes in the dropdown
                crimeTypeDropdown.on('change', function() {
                    var selectedCrimeType = this.value;
                    // Update the map based on the selected crime type
                    updateMapForCrimeType(selectedCrimeType);
                });

                // Function to update the map based on the selected crime type
                function updateMapForCrimeType(crimeType) {
                    // Clear existing layers on the map
                    map.eachLayer(function (layer) {
                        if (layer instanceof L.GeoJSON) {
                            map.removeLayer(layer);
                        }
                    });

                    // Remove existing legend
                    d3.select(".info.legend").remove();

                    // Join the housing data to the GeoJSON
                    d3.json('us-states.json').then(function(us) {
                        us.features.forEach(function(feature) {
                            feature.properties.median_active_list_price = statePrices[feature.properties.NAME] || 0;
                        });

                        // Add a color legend
                        var legend = L.control({position: 'bottomright'});
                        legend.onAdd = function (map) {
                            var div = L.DomUtil.create('div', 'info legend'),
                                grades = [166985, 300000, 400000, 500000, 600000, 700000, 800000, 900000, 981994],  // Adjusted grades to match your data
                                labels = [];
                            for (var i = 0; i < grades.length; i++) {
                                div.innerHTML +=
                                    '<i style="background:' + color(grades[i] + 1) + '"></i> ' +
                                    grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
                            }
                            return div;
                        };
                        legend.addTo(map);

                        // Add a color legend
                        L.geoJSON(us, {
                            style: function(feature) {
                                return {
                                    fillColor: color(feature.properties.median_active_list_price),
                                    weight: 2,
                                    opacity: 1,
                                    color: 'white',
                                    fillOpacity: 0.7
                                };
                            },
                            onEachFeature: function (feature, layer) {
                                // Get the state name
                                var stateName = feature.properties.NAME;

                                // Get the corresponding crime data
                                var crimeData = stateCrimeData[stateName] || { population: 'N/A', totalCrime: 'N/A' };

                                // Check if the selected crime type matches the data for this state
                                if (crimeType === '' || crimeData[crimeType] !== undefined) {
                                    // Create the tooltip content
                                    var tooltipContent = "<b>" + stateName + "</b><br>" +
                                                         "Median list price: $" + feature.properties.median_active_list_price + "<br>" +
                                                         "Population: " + crimeData.population + "<br>" +
                                                         "Total Crime: " + crimeData.totalCrime + "<br>" +
                                                         "Crime Type: " + (crimeType === '' ? 'All' : crimeType) + "<br>" +
                                                         (crimeType === '' ? '' : crimeType + ": " + crimeData[crimeType]);

                                    // Bind the tooltip to the layer
                                    layer.bindTooltip(tooltipContent);
                                    layer.addTo(map);
                                }
                            }
                        });
                    });
                }

                // Initial map load without filtering
                updateMapForCrimeType('');
            });
        });
    </script>
</body>
</html>



